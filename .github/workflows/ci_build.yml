name: CI - Build

on:
    push:
        branches:
        - master
        - dev

    pull_request:
        branches:
        - master
        - dev

jobs:
  xcode-build:
    permissions: write-all
    runs-on: macos-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    - name: "Test SDK versions"
      run: |
        xcodebuild -showsdks

    - name: "Xcode Test"
      uses: sersoft-gmbh/xcodebuild-action@v2
      with:
        project: Mlem.xcodeproj
        scheme: Mlem
        destination: platform=Simulator,name=iPhone 14,OS=16.2
        action: test

    #- name: Build with xcodebuild
    #  run: |
    #    xcodebuild -project ./Mlem.xcodeproj -scheme "Mlem" -sdk "iphonesimulator16.2" -quiet -resultBundlePath "build_results.xcresult"
    #- uses: kishikawakatsumi/xcresulttool@v1
    #  with:
    #    path: build_results.xcresult
    #    upload-bundles: never # Permission issues with uploading
    #  if: success() || failure()
      # ^ This is important because the action will be run
      # even if the test fails in the previous step.